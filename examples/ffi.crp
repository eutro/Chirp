// m*table boxes!

defn box(x) = Î».x
defn unbox(b) = b()
defn box_set<T, Y>(x: T, y, size: i64) =
  let boxed: Y = box(y)
      memcpy(dest: T, src: Y, size: i64): T = foreign in:
    memcpy(x, boxed, size)

let putS(s: string): #() = foreign
    b = box("Hello, ")
  in {
    putS(unbox(b))
    box_set(b, "world!\n", 16)
    putS(unbox(b))
  }
